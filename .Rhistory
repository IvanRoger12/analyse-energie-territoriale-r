evolution_production$Filière <- evolution_production[evolution_production$Filière<>"Production totale"]
evolution_production$Filière <- evolution_production[evolution_production$Filière!="Production totale"]
evolution_production <- filter(evolution_production, Filière != "Production totale")
prod_by_energy = aggregate(Valeur..TWh. ~ Filière, data = evolution_production, sum)
prod_by_energy |>
mutate(Filière = fct_reorder(Filière, Valeur..TWh.)) |>
ggplot(aes(Valeur..TWh., Filière)) + # Inverser x et y ici évite coord_flip()
geom_col(fill = "steelblue") +
geom_text(aes(label = round(Valeur..TWh., 1)), hjust = -0.2) + # Étiquettes
labs(title = "Production électrique (TWh)", x = NULL, y = NULL) +
theme_minimal() +
scale_x_continuous(expand = expansion(mult = c(0, .15))) # Espace pour le texte
ggplot(prod_by_energy, aes(x = Filière, y=Valeur..TWh.))
ggplot(prod_by_energy, aes(x = Filière, y=Valeur..TWh.))+
geom_col(fill = "steelblue")
ggplot(prod_by_energy, aes(x = Filière, y=Valeur..TWh.))+
geom_col(fill = "steelblue")+
geom_text(aes(label = Valeur..TWh.), hjust = -0.2)
ggplot(prod_by_energy, aes(x = Filière, y=Valeur..TWh.))+
geom_col(fill = "steelblue")+
geom_text(aes(label = Valeur..TWh.), hjust = -0.2)+
labs(title = "Production par filière")+
theme_minimal()
prod_by_energy <- aggregate(Valeur..TWh. ~ Filière, data = evolution_production, sum) # Agrégation par filière
ggplot(prod_by_energy, aes(x = Filière, y=Valeur..TWh.))+
geom_col(fill = "steelblue")+
geom_text(aes(label = Valeur..TWh.), hjust = -0.2)+
labs(title = "Production par filière")+
theme_minimal()
prod_by_energy <- order(aggregate(Valeur..TWh. ~ Filière, data = evolution_production, sum)) # Agrégation par filière
prod_by_energy <- prod_by_energy[order(prod_by_energy$Valeur..TWh.)]
prod_by_energy <- (aggregate(Valeur..TWh. ~ Filière, data = evolution_production, sum) # Agrégation par filière
prod_by_energy <- prod_by_energy[order(prod_by_energy$Valeur..TWh.),]
prod_by_energy <- aggregate(Valeur..TWh. ~ Filière, data = evolution_production, sum) # Agrégation par filière
prod_by_energy <- prod_by_energy[order(prod_by_energy$Valeur..TWh.),]
ggplot(prod_by_energy, aes(x = Valeur..TWh., y=Filière))+
geom_col(fill = "steelblue")+
geom_text(aes(label = Valeur..TWh.), hjust = -0.2)+
labs(title = "Production par filière")+
theme_minimal()
prod_by_energy <- aggregate(Valeur..TWh. ~ Filière, data = evolution_production, sum) # Agrégation par filière
prod_by_energy$Filière <- reorder(prod_by_energy$Filière, prod_by_energy$Valeur..TWh.)
ggplot(prod_by_energy, aes(x = Valeur..TWh., y=Filière))+
geom_col(fill = "steelblue")+
geom_text(aes(label = round(Valeur..TWh.,2)), hjust = -0.2)+
labs(title = "Production par filière")+
theme_minimal()
prod_by_energy <- aggregate(Valeur..TWh. ~ Filière, data = evolution_production, sum) # Agrégation par filière
prod_by_energy$Filière <- reorder(prod_by_energy$Filière, prod_by_energy$Valeur..TWh.)
ggplot(prod_by_energy, aes(x = Valeur..TWh., y=Filière))+
geom_col(fill = "steelblue")+
geom_text(aes(label = round(Valeur..TWh.,2)), hjust = -0.2)+
labs(title = "Production par filière")+
scale_x_continuous(expand = expansion(mult = c(0, 0.1)))+
theme_minimal()
ggplot(prod_by_energy, aes(x = Valeur..TWh., y=Filière))+
geom_col(fill = "steelblue")+
geom_text(aes(label = round(Valeur..TWh.,2)), hjust = -0.2)+
labs(title = "Production par filière")+
scale_x_continuous(expand = expansion(mult = c(0, 0.5)))+
theme_minimal()
ggplot(prod_by_energy, aes(x = Valeur..TWh., y=Filière))+
geom_col(fill = "steelblue")+
geom_text(aes(label = round(Valeur..TWh.,2)), hjust = -0.2)+
labs(title = "Production par filière")+
scale_x_continuous(expand = expansion(mult = c(0, 0.3)))+
theme_minimal()
ggplot(prod_by_energy, aes(x = Valeur..TWh., y=Filière))+
geom_col(fill = "steelblue")+
geom_text(aes(label = round(Valeur..TWh.,2)), hjust = -0.2)+
labs(title = "Production par filière")+
scale_x_continuous(expand = expansion(mult = c(0, 0.2)))+
theme_minimal()
library(plotly)
mon_graphique <- ggplot(prod_by_energy, aes(x = Valeur..TWh., y = Filière)) +
geom_col(fill = "steelblue") +
labs(title = "Production par filière", x = "TWh", y = NULL) +
theme_minimal()
# 3. La commande magique pour rendre le tout interactif
ggplotly(mon_graphique)
production_by_month <- aggregate(Valeur..TWh. ~ Date, data = evolution_production, sum)
production_month_line <- ggplot(production_by_month, aes(x = Date, y = Valeur..TWh.))+
geom_line(color = "steelblue", size = 1)+
geom_point(color = "steelblue")+
labs(title = "Evolution de la production par mois", x = mois, y="TWh")
production_by_month <- aggregate(Valeur..TWh. ~ Date, data = evolution_production, sum)
production_month_line <- ggplot(production_by_month, aes(x = Date, y = Valeur..TWh.))+
geom_line(color = "steelblue", linewidth = 1)+
geom_point(color = "steelblue")+
labs(title = "Evolution de la production par mois", x = mois, y="TWh")
production_by_month <- aggregate(Valeur..TWh. ~ Date, data = evolution_production, sum)
production_month_line <- ggplot(production_by_month, aes(x = Date, y = Valeur..TWh.))+
geom_line(color = "steelblue", linewidth = 1)+
geom_point(color = "steelblue")+
labs(title = "Evolution de la production par mois", x = Date, y="TWh")
theme_minimal()
ggplotly(production_month_line)
View(production_by_month)
production_month_line <- ggplot(production_by_month, aes(x = Date, y = Valeur..TWh.))+
geom_line(color = "steelblue", linewidth = 1)+
geom_point(color = "steelblue")+
labs(title = "Evolution de la production par mois", x = Date, y="TWh")
theme_minimal()
ggplotly(production_month_line)
library(lubridate)
#Feature engineering
evolution_production$Date <- ym(evolution_production$Date)
evolution_production$Année <- year(evolution_production$Date)
evolution_production$Mois <- month(evolution_production$Date)
str(evolution_production)
#Feature engineering
evolution_production$Date <- ym(evolution_production$Date)
evolution_production$Année <- year(evolution_production$Date)
evolution_production$Mois <- month(evolution_production$Date, label = TRUE, abbr = FALSE)
View(evolution_production)
# Option pour afficher en notation normale
options(scipen = 999)
#Librairies
library(ggplot2)
library(tidyverse)
library(plotly)
library(lubridate)
#importation des données
evolution_production <- read.csv2("RTE Data/Evolution production electrique.csv", header = TRUE, stringsAsFactors = FALSE, na.strings ="" )
evolution_parc <- read.csv2("RTE Data/Evolution parc.csv", header = TRUE, stringsAsFactors = FALSE, na.strings = "")
evolution_installation <- read.csv2("RTE Data/Partition des installation de prod hors solaire et eolien.csv",header = TRUE, stringsAsFactors = FALSE, na.strings = "")
evolution_installation_hs <- read.csv2("RTE Data/Partition des installations de prod.csv", header = TRUE, stringsAsFactors = FALSE, na.strings = "")
#Description des jeux de données
str(evolution_production)
str(evolution_parc)
str(evolution_installation)
str(evolution_installation_hs)
#Suppression de la colonne Nature
evolution_production$Nature <- NULL
evolution_production <- filter(evolution_production, Filière != "Production totale") #Filtre sur production totale
#Feature engineering
evolution_production$Date <- ym(evolution_production$Date)
evolution_production$Année <- year(evolution_production$Date)
evolution_production$Mois <- month(evolution_production$Date, label = TRUE, abbr = FALSE)
View(head(evolution_production))
prod_by_energy <- aggregate(Valeur..TWh. ~ Filière, data = evolution_production, sum) # Agrégation par filière
prod_by_energy$Filière <- reorder(prod_by_energy$Filière, prod_by_energy$Valeur..TWh.)
bar_chart_energy <- ggplot(prod_by_energy, aes(x = Valeur..TWh., y = Filière)) +
geom_col(fill = "steelblue") +
labs(title = "Production par filière", x = "TWh", y = NULL) +
theme_minimal()
# 3. La commande magique pour rendre le tout interactif
ggplotly(bar_chart_energy)
production_by_month <- aggregate(Valeur..TWh. ~ Date, data = evolution_production, sum)
production_month_line <- ggplot(production_by_month, aes(x = Date, y = Valeur..TWh.))+
geom_line(color = "steelblue", linewidth = 1)+
geom_point(color = "steelblue")+
labs(title = "Evolution de la production par mois", x = Date, y="TWh")
theme_minimal()
ggplotly(production_month_line)
View(production_by_month)
str(evolution_production)
p2 <- ggplot(evolution_production, aes(x = Mois, y = Valeur..TWh., group = Annee, color = as.factor(Annee))) +
geom_line() +
labs(title = "Comparaison saisonnière par mois", x = "Mois", y = "TWh", color = "Année") +
theme_minimal()
ggplotly(p2)
p2 <- ggplot(evolution_production, aes(x = Mois, y = Valeur..TWh., group = Annee, color = as.factor(Annee))) +
geom_line() +
labs(title = "Comparaison saisonnière par mois", x = "Mois", y = "TWh", color = Année) +
theme_minimal()
p2 <- ggplot(evolution_production, aes(x = Mois, y = Valeur..TWh., group = Année, color = as.factor(Annee))) +
geom_line() +
labs(title = "Comparaison saisonnière par mois", x = "Mois", y = "TWh", color = "Année") +
theme_minimal()
ggplotly(p2)
p2 <- ggplot(evolution_production, aes(x = Mois, y = Valeur..TWh., group = Année, color = as.factor(Année))) +
geom_line() +
labs(title = "Comparaison saisonnière par mois", x = "Mois", y = "TWh", color = "Année") +
theme_minimal()
ggplotly(p2)
evolution_production$Trimestre <- paste0("T",quarter(evolution_production$Date, with_year = FALSE))
View(evolution_production)
p2 <- ggplot(evolution_production, aes(x = Trimestre, y = Valeur..TWh., group = Année, color = as.factor(Année))) +
geom_line() +
labs(title = "Comparaison saisonnière par mois", x = "Mois", y = "TWh", color = "Année") +
theme_minimal()
ggplotly(p2)
shiny::runApp('production_electrique')
runApp('production_electrique')
runApp('production_electrique')
runApp()
runApp()
runApp()
runApp()
runApp('electricity_production_dashboard.R')
#Librairies
library(ggplot2)
library(tidyverse)
library(plotly)
library(lubridate)
#importation des données
heat_volume_region <- read.csv2("Volume de chaleur/volume_de_chaleur_region")
#importation des données
heat_volume_region <- read.csv2("Volume de chaleur/volume_de_chaleur_region.csv")
heat_volume_departement <- read.csv2("Volume de chaleur/volume_de_chaleur_departement.csv")
heat_volume_commune <- read.csv2("Volume de chaleur/volume_de_chaleur_commune.csv")
str(heat_volume_region)
str(heat_volume_departement)
str(heat_volume_commune)
View(heat_volume_commune)
View(heat_volume_commune)
#Librairies
library(ggplot2)
library(tidyverse)
library(plotly)
library(lubridate)
#importation des données
heat_volume_region <- read.csv("Volume de chaleur/volume_de_chaleur_region.csv",header = TRUE, stringsAsFactors = FALSE, na.strings = "")
heat_volume_departement <- read.csv("Volume de chaleur/volume_de_chaleur_departement.csv", header = TRUE, stringsAsFactors = FALSE, na.strings = "")
heat_volume_commune <- read.csv("Volume de chaleur/volume_de_chaleur_commune.csv", header = TRUE, stringsAsFactors = FALSE, na.strings = "")
str(heat_volume_region)
str(heat_volume_departement)
str(heat_volume_commune)
View(heat_volume_commune)
View(heat_volume_departement)
View(heat_volume_region)
head(heat_volume_commune)
head(heat_volume_region)
head(heat_volume_departement)
heat_volume_region$filiere <- NULL
heat_volume_departement$filiere <- NULL
heat_volume_commune$filiere <- NULL
View(heat_volume_region)
# --- Préparation de l'environnement ---
library(shiny)
library(shinydashboard)
install.packages("shinydashboard")
# --- Préparation de l'environnement ---
library(shiny)
library(shinydashboard)
library(tidyverse)
library(plotly)
library(lubridate)
library(DT) # Pour des tableaux de données professionnels
# --- 1. Chargement et Nettoyage ---
# On simule le chargement avec vos objets (à adapter avec vos chemins de fichiers)
# heat_region <- read.csv(...) etc.
clean_heat_data <- function(df) {
df %>%
mutate(
# Conversion de la date (format ISO 8601)
date_mesure = as.Date(substr(date_mesure, 1, 10)),
annee = year(date_mesure)
) %>%
# On garde les colonnes utiles (on ignore filiere comme vous l'avez fait)
select(-contains("filiere"))
}
# Application du nettoyage (en supposant que vos fichiers sont chargés)
# data_reg <- clean_heat_data(heat_volume_region)
# data_dept <- clean_heat_data(heat_volume_departement)
# data_com <- clean_heat_data(heat_volume_commune)
# --- 2. Interface Utilisateur (UI) ---
ui <- dashboardPage(
skin = "green", # "Green" pour évoquer la transition énergétique
dashboardHeader(title = "Observatoire Chaleur"),
dashboardSidebar(
sidebarMenu(
menuItem("Analyse Territoriale", tabName = "map_analysis", icon = icon("map-marker-alt")),
menuItem("Données Brutes", tabName = "raw_data", icon = icon("table")),
hr(),
# Filtres globaux
selectInput("year_filter", "Année d'observation :",
choices = NULL), # Sera rempli par le serveur
radioButtons("level_filter", "Niveau de détail :",
choices = c("Région" = "reg", "Département" = "dept", "Commune" = "com"),
selected = "reg")
)
),
dashboardBody(
tabItems(
tabItem(tabName = "map_analysis",
fluidRow(
valueBoxOutput("total_volume", width = 4),
valueBoxOutput("count_territories", width = 4),
valueBoxOutput("avg_volume", width = 4)
),
fluidRow(
box(title = "Classement des territoires (Top 10)", status = "success",
solidHeader = TRUE, plotlyOutput("barRanking"), width = 7),
box(title = "Évolution temporelle", status = "warning",
solidHeader = TRUE, plotlyOutput("timeSeries"), width = 5)
),
fluidRow(
box(title = "Répartition par Région (si détail dept/com choisi)",
status = "info", solidHeader = TRUE, plotlyOutput("pieDistribution"), width = 12)
)
),
tabItem(tabName = "raw_data",
box(title = "Exploration des données", width = 12, DTOutput("dataTable"))
)
)
)
)
# --- 3. Logique Serveur ---
server <- function(input, output, session) {
# Sélection dynamique des données selon le niveau choisi
current_df <- reactive({
if(input$level_filter == "reg") return(data_reg)
if(input$level_filter == "dept") return(data_dept)
return(data_com)
})
# Mise à jour des choix d'année selon les données disponibles
observe({
years <- sort(unique(current_df()$annee), decreasing = TRUE)
updateSelectInput(session, "year_filter", choices = years, selected = years[1])
})
# Filtrage par année
filtered_data <- reactive({
req(input$year_filter)
current_df() %>% filter(annee == input$year_filter)
})
# --- Indicateurs (ValueBoxes) ---
output$total_volume <- renderValueBox({
total <- sum(filtered_data()$valeur, na.rm = TRUE)
valueBox(paste0(round(total, 2), " GWh"), "Volume Total", icon = icon("fire"), color = "red")
})
output$count_territories <- renderValueBox({
n <- nrow(filtered_data())
valueBox(n, "Entités recensées", icon = icon("city"), color = "blue")
})
output$avg_volume <- renderValueBox({
moyenne <- mean(filtered_data()$valeur, na.rm = TRUE)
valueBox(paste0(round(moyenne, 3)), "Moyenne par entité", icon = icon("chart-line"), color = "olive")
})
# --- Graphiques ---
# Ranking Bar Chart
output$barRanking <- renderPlotly({
# Détecter quelle colonne de libellé utiliser
col_label <- names(filtered_data())[grep("libelle", names(filtered_data()))]
top_10 <- filtered_data() %>%
arrange(desc(valeur)) %>%
head(10)
p <- ggplot(top_10, aes(x = reorder(!!sym(col_label), valeur), y = valeur, fill = valeur)) +
geom_col() +
coord_flip() +
scale_fill_gradient(low = "#91cf60", high = "#1a9850") +
theme_minimal() +
labs(x = NULL, y = "Volume de chaleur")
ggplotly(p) %>% hide_legend()
})
# Time Series (Evolution)
output$timeSeries <- renderPlotly({
# Evolution globale par année pour le niveau choisi
evo <- current_df() %>%
group_by(annee) %>%
summarise(total = sum(valeur, na.rm = TRUE))
p <- ggplot(evo, aes(x = annee, y = total)) +
geom_line(color = "#27ae60", size = 1) +
geom_point(color = "#27ae60", size = 2) +
theme_minimal() +
labs(x = "Année", y = "Volume total")
ggplotly(p)
})
# Table de données
output$dataTable <- renderDT({
datatable(filtered_data(), options = list(pageLength = 10, scrollX = TRUE),
filter = 'top', rownames = FALSE)
})
}
# Lancer l'app
shinyApp(ui, server)
# --- Librairies ---
library(shiny)
library(shinydashboard)
library(tidyverse)
library(plotly)
library(lubridate)
library(DT)
# --- 1. Importation et Préparation des données ---
# Utilisation de vos chemins d'accès exacts
import_data <- function(path) {
df <- read.csv(path, header = TRUE, stringsAsFactors = FALSE, na.strings = "")
# Nettoyage immédiat
df <- df %>%
mutate(
# Nettoyage de la date (on garde les 10 premiers caractères pour as.Date)
date_mesure = as.Date(substr(date_mesure, 1, 10)),
annee = year(date_mesure),
# On s'assure que la valeur est numérique
valeur = as.numeric(valeur)
) %>%
# Suppression de la colonne filiere comme demandé
select(-filiere)
return(df)
}
# Chargement des fichiers
heat_reg  <- import_data("Volume de chaleur/volume_de_chaleur_region.csv")
heat_dept <- import_data("Volume de chaleur/volume_de_chaleur_departement.csv")
heat_com  <- import_data("Volume de chaleur/volume_de_chaleur_commune.csv")
# --- 2. Interface Utilisateur (UI) ---
ui <- dashboardPage(
skin = "green",
dashboardHeader(title = "Analyse Chaleur CGDD"),
dashboardSidebar(
sidebarMenu(
menuItem("Tableau de bord", tabName = "dashboard", icon = icon("chart-line")),
menuItem("Explorateur de données", tabName = "data", icon = icon("database")),
hr(),
# Sélecteurs
selectInput("selected_year", "Choisir l'année :",
choices = sort(unique(heat_reg$annee), decreasing = TRUE)),
radioButtons("geo_level", "Échelle territoriale :",
choices = c("Régionale" = "reg",
"Départementale" = "dept",
"Communale" = "com"),
selected = "reg")
)
),
dashboardBody(
tabItems(
# Onglet Principal
tabItem(tabName = "dashboard",
fluidRow(
valueBoxOutput("total_val", width = 6),
valueBoxOutput("top_territory", width = 6)
),
fluidRow(
box(title = "Top 15 des territoires", status = "success", solidHeader = TRUE,
plotlyOutput("bar_plot"), width = 8),
box(title = "Part du volume", status = "success", solidHeader = TRUE,
plotlyOutput("pie_plot"), width = 4)
),
fluidRow(
box(title = "Évolution historique du volume total", status = "info",
solidHeader = TRUE, plotlyOutput("trend_plot"), width = 12)
)
),
# Onglet Données
tabItem(tabName = "data",
box(title = "Recherche et filtrage avancé", width = 12,
DTOutput("table_raw"))
)
)
)
)
# --- 3. Logique Serveur ---
server <- function(input, output) {
# Réactivité : Sélection du dataset selon le bouton radio
reactive_df <- reactive({
if (input$geo_level == "reg") return(heat_reg)
if (input$geo_level == "dept") return(heat_dept)
return(heat_com)
})
# Réactivité : Filtrage par année
filtered_df <- reactive({
reactive_df() %>% filter(annee == input$selected_year)
})
# KPI 1 : Volume Total
output$total_val <- renderValueBox({
v <- sum(filtered_df()$valeur, na.rm = TRUE)
valueBox(paste0(round(v, 2), " GWh"), "Volume Total Consommé",
icon = icon("fire"), color = "red")
})
# KPI 2 : Territoire leader
output$top_territory <- renderValueBox({
col_name <- names(filtered_df())[3] # Récupère le libellé (reg, dept ou com)
top_1 <- filtered_df() %>% arrange(desc(valeur)) %>% slice(1)
valueBox(top_1[[col_name]], "Premier contributeur",
icon = icon("trophy"), color = "yellow")
})
# Graphique : Barres (Ranking)
output$bar_plot <- renderPlotly({
col_label <- names(filtered_df())[3]
p <- filtered_df() %>%
arrange(desc(valeur)) %>%
head(15) %>%
ggplot(aes(x = reorder(!!sym(col_label), valeur), y = valeur, fill = valeur)) +
geom_col() +
coord_flip() +
scale_fill_viridis_c(option = "mako") +
theme_minimal() +
labs(x = NULL, y = "Volume (GWh)")
ggplotly(p)
})
# Graphique : Evolution temporelle
output$trend_plot <- renderPlotly({
# On prend la tendance globale du dataset sélectionné
trend <- reactive_df() %>%
group_by(annee) %>%
summarise(total = sum(valeur, na.rm = TRUE))
p <- ggplot(trend, aes(x = annee, y = total)) +
geom_line(color = "#27ae60", size = 1) +
geom_point(color = "#27ae60") +
theme_minimal() +
labs(x = "Année", y = "Volume global")
ggplotly(p)
})
# Graphique : Camembert (Pie)
output$pie_plot <- renderPlotly({
col_label <- names(filtered_df())[3]
# On groupe les petits territoires en "Autres" pour la lisibilité
data_pie <- filtered_df() %>%
arrange(desc(valeur)) %>%
mutate(label = ifelse(row_number() <= 5, !!sym(col_label), "Autres")) %>%
group_by(label) %>%
summarise(valeur = sum(valeur))
plot_ly(data_pie, labels = ~label, values = ~valeur, type = 'pie',
textinfo = 'label+percent', insidetextorientation = 'radial')
})
# Table de données interactive
output$table_raw <- renderDT({
datatable(filtered_df(), options = list(pageLength = 10), rownames = FALSE)
})
}
# --- Lancement ---
shinyApp(ui, server)
